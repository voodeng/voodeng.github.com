<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Hexo + Travis-CI 自动化部署到 Github · Voodeng's</title><meta name="description" content="Hexo + Travis-CI 自动化部署到 Github - Voodeng"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://voodeng.github.com/atom.xml" title="Voodeng's"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/logo.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/voodeng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/voodeng" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Hexo + Travis-CI 自动化部署到 Github</h1><div class="post-info">Jun 4, 2018</div><div class="post-content"><h2 id="Hexo"><a href="#Hexo" class="headerlink" title="Hexo"></a>Hexo</h2><p>hexo 新建后，改变源文件分支至hexo-source</p>
<p>master分支仅放入hexo g生成的文件</p>
<h2 id="Travis-CI"><a href="#Travis-CI" class="headerlink" title="Travis CI"></a>Travis CI</h2><p><a href="http://yaml-online-parser.appspot.com/" target="_blank" rel="noopener">travis yaml online lint</a></p>
<h3 id="travis-yml-部署"><a href="#travis-yml-部署" class="headerlink" title=".travis.yml 部署"></a>.travis.yml 部署</h3><p>CI_TOKEN 是 Github Person access key，需要去 Github 生成，然后在 travis-ci 项目中定义环境变量</p>
<ul>
<li>并不推荐，是强制push，git里只有一条记录</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">after_script:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">cd</span> <span class="string">./public</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">git</span> <span class="string">init</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">git</span> <span class="string">add</span> <span class="string">.</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">git</span> <span class="string">commit</span> <span class="bullet">-m</span> <span class="string">"TravisCI Hexo Generate"</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">git</span> <span class="string">push</span> <span class="bullet">--force</span> <span class="bullet">--quiet</span> <span class="string">"https://$&#123;CI_TOKEN&#125;@$&#123;GH_REF&#125;"</span> <span class="attr">master:master</span></span><br></pre></td></tr></table></figure>
<ul>
<li>先 clone 再 commit，避免直接 force commit，brance 会延续 commit， 并 commit 信息</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">after_success:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">git</span> <span class="string">clone</span> <span class="bullet">-b</span> <span class="string">master</span> <span class="string">"https://$&#123;GH_REF&#125;"</span> <span class="string">.deploy_git</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">cd</span> <span class="string">.deploy_git</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">git</span> <span class="string">checkout</span> <span class="string">master</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">mv</span> <span class="string">.git/</span> <span class="string">../public/</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">cd</span> <span class="string">../public</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">git</span> <span class="string">add</span> <span class="string">.</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">git</span> <span class="string">commit</span> <span class="bullet">-m</span> <span class="string">"Site updated $&#123;STAMP&#125;"</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">git</span> <span class="string">push</span> <span class="bullet">--force</span> <span class="bullet">--quiet</span> <span class="string">"https://$&#123;CI_TOKEN&#125;@$&#123;GH_REF&#125;"</span> <span class="attr">master:master</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">env:</span></span><br><span class="line"><span class="attr"> global:</span></span><br><span class="line">   <span class="comment"># Github Pages</span></span><br><span class="line"><span class="attr">   - GH_REF:</span> <span class="string">github.com/voodeng/voodeng.github.com.git</span></span><br><span class="line">   <span class="comment"># 时间是根据服务器来的</span></span><br><span class="line"><span class="attr">   - STAMP:</span> <span class="string">$(date</span> <span class="string">+%Y-%m-%d-%H:%M:%S)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>分离的脚本</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -ev</span><br><span class="line"><span class="built_in">export</span> TZ=<span class="string">'Asia/Shanghai'</span></span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> -b master <span class="string">"https://<span class="variable">$&#123;GH_REF&#125;</span>"</span> .deploy_git</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> .deploy_git</span><br><span class="line">git checkout master</span><br><span class="line">mv .git/ ../public/</span><br><span class="line"><span class="built_in">cd</span> ../public</span><br><span class="line"></span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">"Site updated: `date +"</span>%Y-%m-%d %H:%M:%S<span class="string">"`"</span></span><br><span class="line">git push --force --quiet <span class="string">"https://<span class="variable">$&#123;CI_TOKEN&#125;</span>@<span class="variable">$&#123;GH_REF&#125;</span>"</span> master:master</span><br></pre></td></tr></table></figure>
<h3 id="使用-hexo-deploy"><a href="#使用-hexo-deploy" class="headerlink" title="使用 hexo-deploy"></a>使用 hexo-deploy</h3><p>_config.yml 里<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">git</span></span><br><span class="line"><span class="attr">  repo:</span> <span class="string">git@github.com:voodeng/voodeng.github.com.git</span> <span class="comment"># 这里需要替换下</span></span><br><span class="line"><span class="attr">  branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure></p>
<p>在.travis.yml中，构建过程中替换<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">after_success:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">sed</span> <span class="bullet">-i''</span> <span class="string">"/^ *repo/s~git@github\.com~https://$&#123;CI_TOKEN&#125;@github.com~"</span> <span class="string">_config.yml</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">hexo</span> <span class="string">deploy</span></span><br></pre></td></tr></table></figure></p>
<p>还是需要定义一下push过程，不然一样只有一个commit</p>
<h2 id="Prose-io"><a href="#Prose-io" class="headerlink" title="Prose.io"></a>Prose.io</h2><p><img src="https://prose.io/img/prose@57.png" alt=""></p>
<p><a href="https://prose.io" target="_blank" rel="noopener">Prose</a> 等在线的工具，只要能访问 Github 分支并新建保存 markdown 文件，保存后即可自动同步哈</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="http://www.qingpingshan.com/m/view.php?aid=387037" target="_blank" rel="noopener">http://www.qingpingshan.com/m/view.php?aid=387037</a></p>
<p><a href="https://iamstarkov.com/deploy-gh-pages-from-travis/" target="_blank" rel="noopener">https://iamstarkov.com/deploy-gh-pages-from-travis/</a></p>
<p><a href="https://blessing.studio/deploy-hexo-blog-automatically-with-travis-ci/" target="_blank" rel="noopener">https://blessing.studio/deploy-hexo-blog-automatically-with-travis-ci/</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/06/04/Cover/" class="next">NEXT</a></div><div class="copyright"><p>© 2018 <a href="http://voodeng.github.com">Voodeng</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>